
<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Withdraw • Investology Crypto</title>

    <script>
    // Protect all pages - redirect to login if not authenticated
    if (!localStorage.getItem('currentUser')) {
        window.location.href = 'index.html';
    } else {
        const user = JSON.parse(localStorage.getItem('currentUser'));
        // Optional: extra check (in case someone tampers with storage)
        if (user.username !== "Rose2317") {
            localStorage.removeItem('currentUser');
            window.location.href = 'index.html';
        }
    }
    </script>

    
    <link rel="stylesheet" href="styles.css">
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@300;400;500;600;700;900&display=swap" rel="stylesheet">
</head>
<body>
    <div class="background-particles"></div>

    <div class="app-container">
        <!-- Premium Header -->
        <header class="app-header premium-header">
            <div class="header-left">
                <button class="back-btn" onclick="window.history.back()">←</button>
            </div>
            <div class="header-center">Withdraw</div>
        </header>

        <main class="withdraw-main">
            <!-- Balance & VIP Status -->
            <section class="withdraw-balance premium-card glass-glow">
                <div class="balance-header">
                    <div class="user-info">
                        <span class="greeting">Welcome back,</span>
                        <span class="username">Rose2317</span>
                        <span class="vip-badge vip6 glowing-vip">VIP4</span>
                    </div>
                </div>

                <div class="balance-display">
                    <div class="label">Available Balance</div>
                    <div class="big-balance gradient-text">2,660,222.00 <span class="currency">USDT</span></div>
                </div>

                <div class="limits-row">
                    <div class="limit-box">
                        <div class="limit-label">Vip4 Withdraw Limit</div>
                        <div class="limit-value">4,000,000 USDT</div>
                    </div>
                    <div class="limit-box">
                        <div class="limit-label">Withdraw Limit Remaining</div>
                        <div class="limit-value">2,850 USDT</div>
                    </div>
                </div>
            </section>

            <!-- Withdrawal Form – Premium Glass Panel -->
            <section class="withdraw-interface premium-card glass-glow">
                <h2 class="gradient-title">Withdraw Funds</h2>

                <div class="withdraw-form">
                    <div class="form-row">
                        <label>Wallet Address</label>
                        <input type="text" class="form-input premium-input" placeholder="Enter your wallet address" id="wallet-address" oninput="validateForm()" />
                        <p class="instruction-note">Wallet address should be USDT on Tron network (USDT TRC20)</p>
                        <p class="error-message" id="address-error" style="display: none; color: #f87171; font-size: 0.9rem; margin-top: 0.5rem;">
                            Please enter a valid wallet address
                        </p>
                    </div>

                    <div class="form-row">
                        <label>Amount (USDT)</label>
                        <input type="number" class="form-input premium-input" placeholder="0.00" id="withdraw-amount" min="0" step="0.01" oninput="calculateTotal(); validateForm()" />
                        <p class="min-note">Minimum withdrawal: 5,000 USDT</p>
                        <p class="error-message" id="amount-error" style="display: none; color: #f87171; font-size: 0.9rem; margin-top: 0.5rem;">
                            Minimum withdrawal amount is 5,000 USDT
                        </p>
                    </div>

                    <div class="fee-info">
                        <div class="fee-row">
                            <span>Network Fee</span>
                            <span>1.00 USDT</span>
                        </div>
                        <div class="fee-row total">
                            <span>Total</span>
                            <span class="total-value" id="total-amount">0.00 USDT</span>
                        </div>
                    </div>

                    <button class="btn-withdraw premium-btn" id="withdraw-btn" disabled onclick="showConfirmWithdraw()">Withdraw Now</button>
                </div>
            </section>

            <!-- Confirmation Popup -->
            <div id="confirm-withdraw-popup" class="modal-overlay" style="display: none;">
                <div class="modal-content glass-glow">
                    <button class="modal-close" onclick="closeConfirmWithdraw()">×</button>
                    <h2 class="modal-title">Confirm Withdrawal</h2>
                    <p class="modal-message">Are you sure you want to withdraw?</p>
                    <div class="modal-actions">
                        <button class="btn-cancel" onclick="closeConfirmWithdraw()">Cancel</button>
                        <button class="btn-confirm premium-btn" onclick="showExpiredError()">Confirm & Submit</button>
                    </div>
                </div>
            </div>

            <!-- Expired Plan Error Popup (same as trade page) -->
            <div id="expired-popup" class="modal-overlay" style="display: none;">
                <div class="modal-content glass-glow">
                    <button class="modal-close" onclick="closeExpiredPopup()">×</button>
                    <h2 class="modal-title gradient-title">Plan Expired</h2>
                    <p class="modal-message">Increase your plan first. Your current plan is expired.</p>
                    <div class="modal-actions">
                        <button class="btn-upgrade premium-btn" onclick="window.location.href='membership.html'">Upgrade Plan</button>
                        <button class="btn-cancel" onclick="closeExpiredPopup()">Close</button>
                    </div>
                </div>
            </div>

            <!-- Bottom Navigation -->
            <nav class="bottom-nav premium-nav">
                <a href="home.html" class="nav-item">
                    <span>Dashboard</span>
                </a>
                <a href="trade.html" class="nav-item">
                    <span>Trade</span>
                </a>
                <a href="transfer.html" class="nav-item">
                    <span>Transfer</span>
                </a>
                <a href="account.html" class="nav-item">
                    <span>Account</span>
                </a>
            </nav>
        </main>
    </div>

    <script>
        const MIN_WITHDRAW = 5000;
        const NETWORK_FEE = 1.00;

        // Calculate Total & Validate Form
        function calculateTotal() {
            const amountInput = document.getElementById('withdraw-amount');
            const totalEl = document.getElementById('total-amount');
            const amountError = document.getElementById('amount-error');
            const addressError = document.getElementById('address-error');
            const withdrawBtn = document.getElementById('withdraw-btn');

            const amount = parseFloat(amountInput.value) || 0;
            const total = amount + NETWORK_FEE;

            totalEl.textContent = total.toLocaleString('en-US', {
                minimumFractionDigits: 2,
                maximumFractionDigits: 2
            }) + ' USDT';

            // Amount validation
            if (amount > 0 && amount < MIN_WITHDRAW) {
                amountError.style.display = 'block';
            } else {
                amountError.style.display = 'none';
            }

            validateForm();
        }

        // Form Validation (enable/disable button)
        function validateForm() {
            const amountInput = document.getElementById('withdraw-amount');
            const addressInput = document.getElementById('wallet-address');
            const amountError = document.getElementById('amount-error');
            const addressError = document.getElementById('address-error');
            const withdrawBtn = document.getElementById('withdraw-btn');

            const amount = parseFloat(amountInput.value) || 0;
            const address = addressInput.value.trim();

            const isAmountValid = amount >= MIN_WITHDRAW;
            const isAddressValid = address.length >= 10; // Basic check (you can improve regex later)

            if (!isAddressValid && address.length > 0) {
                addressError.style.display = 'block';
            } else {
                addressError.style.display = 'none';
            }

            // Enable button only if both are valid
            withdrawBtn.disabled = !(isAmountValid && isAddressValid);
        }

        // Confirm Withdrawal Popup
        function showConfirmWithdraw() {
            document.getElementById('confirm-withdraw-popup').style.display = 'flex';
        }

        function closeConfirmWithdraw() {
            document.getElementById('confirm-withdraw-popup').style.display = 'none';
        }

        // Show Expired Error (same as trade page)
        function showExpiredError() {
            closeConfirmWithdraw();
            document.getElementById('expired-popup').style.display = 'flex';
        }

        function closeExpiredPopup() {
            document.getElementById('expired-popup').style.display = 'none';
        }

        // Initial call to disable button on load
        window.onload = function() {
            validateForm();
        };
    </script>
</body>
</html>
